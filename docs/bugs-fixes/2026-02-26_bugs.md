# Bug Report: 2026-02-26

## BUG-5: ExerciseListScreen back arrow on Library tab
**Status:** FIXED (2026-02-26)
**Priority:** P2
**Reported:** 2026-02-26
**Screen:** Exercise List (`ExerciseListScreen.kt`)

### Problem
ExerciseListScreen shows a back arrow in its TopAppBar when accessed as the Library tab root. Tapping it calls `navController.popBackStack()` which returns false and does nothing. The arrow should be conditionally hidden when the screen is a top-level tab destination.

### Fix
Added optional `showBackButton: Boolean = true` parameter to `ExerciseListScreen` and `ExerciseListContent`. The TopAppBar's navigationIcon now conditionally renders the back button based on this flag. Updated the NavGraphBuilder extension `exerciseListScreen()` to accept and pass the parameter. In DeepRepsNavHost.kt, the tab destination call passes `showBackButton = false` to hide the button when used as a root-level screen. Backward compatible — existing callers (exercise selection detail flow) default to showing the button.

### Files
- `feature/exercise-library/src/main/java/com/deepreps/feature/exerciselibrary/ExerciseListScreen.kt`
- `feature/exercise-library/src/main/java/com/deepreps/feature/exerciselibrary/navigation/ExerciseLibraryNavigation.kt`
- `app/src/main/java/com/deepreps/app/DeepRepsNavHost.kt`

---

## BUG-6: Template exercise count shows 0 on Home screen
**Status:** FIXED (2026-02-26)
**Priority:** P2
**Reported:** 2026-02-26
**Screen:** Home (`HomeViewModel.kt`)

### Problem
`TemplateInfo.exerciseCount` in the Recent Templates section was hardcoded to 0 because fetching exercise counts per template requires N+1 suspend calls.

### Root Cause
`HomeViewModel.observeHomeData()` used `templateRepository.getAll()` which returns only template metadata without exercise counts. Computing counts in the ViewModel would require a suspend call per template inside a Flow pipeline.

### Fix
Added a single efficient Room query that performs a LEFT JOIN + GROUP BY to compute exercise counts per template without N+1 calls:

1. Created `TemplateWithExerciseCountProjection` — Room projection for the aggregated query result
2. Created `TemplateWithCount` — Domain model for the data
3. Added `getAllWithExerciseCount(): Flow<List<TemplateWithExerciseCount>>` to `TemplateRepository` interface
4. Implemented in `TemplateRepositoryImpl` with mapper
5. Updated `HomeViewModel` to use the new method and map to `TemplateInfo` with correct counts
6. Fixed pre-existing compilation error in `ExerciseListScreen.kt` (navigationIcon type inference issue)

### Files
- `core/database/src/main/java/com/deepreps/core/database/dao/TemplateDao.kt` — Added `getAllWithExerciseCount()` query with LEFT JOIN + GROUP BY
- `core/database/src/main/java/com/deepreps/core/database/entity/TemplateWithExerciseCountProjection.kt` — NEW
- `core/data/src/main/java/com/deepreps/core/data/mapper/TemplateMapper.kt` — Added projection-to-domain mapper
- `core/data/src/main/java/com/deepreps/core/data/repository/TemplateRepositoryImpl.kt` — Implemented new method
- `core/domain/src/main/java/com/deepreps/core/domain/repository/TemplateRepository.kt` — Added interface method
- `core/domain/src/main/java/com/deepreps/core/domain/model/TemplateWithCount.kt` — NEW
- `app/src/main/java/com/deepreps/app/HomeViewModel.kt` — Updated to use new repository method
- `feature/exercise-library/src/main/java/com/deepreps/feature/exerciselibrary/ExerciseListScreen.kt` — Fixed navigationIcon type

---

## BUG-7: Dead ProfilePlaceholder.kt in :app module
**Status:** FIXED (2026-02-26)
**Priority:** P3
**Reported:** 2026-02-26
**Screen:** N/A (dead code)

### Problem
`ProfilePlaceholder.kt` in the `:app` module is no longer referenced after the Settings screen was wired via `settingsScreen()` in `DeepRepsNavHost.kt`. Should be deleted.

### Files
- `app/src/main/java/com/deepreps/app/ProfilePlaceholder.kt`

---

## BUG-4: SkipSet does not auto-collapse exercise
**Status:** FIXED (2026-02-26)
**Priority:** P1
**Reported:** 2026-02-26
**Screen:** Active Workout (`WorkoutScreen.kt`)
**Plan:** `2026-02-26_plan_nav-settings-core-loop.md` (item 1.1)

### Problem
Skipping the last set of an exercise didn't auto-minimize it and advance to the next exercise. Completing the last set did auto-collapse correctly.

### Root Cause
`handleSkipSet()` in `WorkoutViewModel.kt` only updated the set status — it lacked the auto-advance logic that `handleCompleteSet()` had (check remaining sets -> collapse current -> expand next -> scroll -> rest timer).

### Fix
Extracted `maybeAutoAdvanceExercise(startRestTimer: Boolean)` helper, called from both handlers. No rest timer starts after skip-advance (unlike complete-advance). 4 new unit tests added.

### Files
- `feature/workout/active/WorkoutViewModel.kt`
- `feature/workout/active/WorkoutViewModelTest.kt`

---

## BUG-1: Exercise Order screen - drag-to-reorder is non-functional
**Status:** FIXED
**Priority:** P0
**Reported:** 2026-02-13
**Screen:** Exercise Order (`ExerciseOrderScreen.kt`)

### Problem
Exercises on the order screen cannot be dragged. The implementation uses `detectDragGesturesAfterLongPress` which requires a long-press to initiate drag. No visual affordance on the cards to suggest they're draggable.

### Fix
Replaced with touch-and-move drag. Added elevation, shift animation, and haptic feedback. Full details in earlier session.

### Files
- `feature/workout/setup/ExerciseOrderScreen.kt`
- `core/ui/component/DragDropState.kt`
- `feature/workout/setup/WorkoutSetupViewModel.kt`

---

## BUG-2: Plan Review screen - empty content, non-functional buttons
**Status:** FIXED
**Priority:** P0
**Reported:** 2026-02-13
**Screen:** Plan Review (`PlanReviewScreen.kt`)

### Problem
After hitting "Generate Plan", the Plan Review screen shows an empty plan. Both "Regenerate" and "Start Workout" buttons are non-functional.

### Root Cause
Multiple silent failures in the plan generation fallback chain. `userProfileRepository.get()` returning null, `executePlanGeneration()` setting PlanReady with empty list instead of Error phase.

### Fix
Fixed fallback chain, error state handling, and button states. Full details in earlier session.

### Files
- `feature/ai-plan/PlanReviewViewModel.kt`
- `feature/ai-plan/PlanReviewScreen.kt`
- `core/domain/usecase/GeneratePlanUseCase.kt`
- `core/domain/provider/BaselinePlanGenerator.kt`

---

## BUG-3: Exercise Detail screen - empty anatomy diagram
**Status:** FIXED
**Priority:** P1
**Reported:** 2026-02-13
**Screen:** Exercise Detail (`ExerciseDetailScreen.kt`)

### Problem
The "Anatomy Diagram" section shows only a colored placeholder box. No actual muscle visualization.

### Fix
Replaced placeholder with SVG-based anatomy diagram using muscle group highlighting. Full details in earlier session.

### Files
- `feature/exercise-library/components/AnatomyDiagram.kt`
- `feature/exercise-library/ExerciseDetailScreen.kt`
